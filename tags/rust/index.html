<!doctype html><html><head><meta charset=utf-8><title>Today I Learned</title><link rel=alternate type=application/rss+xml href=https://skalt.github.io/til/tags/rust/index.xml title="Today I Learned"><link rel=stylesheet href=https://skalt.github.io/til/critical.min.594b5b7a363d42cef2053010611ce4d2364196b08b295f8bf7199f9406b595e4.css></head><body><header><h1><a href=https://skalt.github.io/til/>Today I Learned</a></h1><nav><a href=https://skalt.github.io/til/tags>tags</a>
<a href=https://skalt.github.io/til/search>search</a>
<a href=https://github.com/skalt/til><img alt=repo title=repo src=https://skalt.github.io/til/icon_gh.512c0dbb601adf88d85cdd317f632f04c74f76183e9dd30c331272d46a59aa13.svg></a>
<a href=https://skalt.github.io/til/tags/rust/index.xml><img alt=rss title=rss src=https://skalt.github.io/til/icon_rss.2712ea2c7402d63d00f842fbc9dc64b6461012d726f7385aae61b031d1614ebd.svg></a></a></nav></header><main><article><a href=https://skalt.github.io/til/2022/04/13/></a><p>That a rust if-statement can have a return type</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>let</span> x: <span style=color:#66d9ef>u32</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>123</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> stmt_result <span style=color:#f92672>=</span> <span style=color:#66d9ef>if</span> x <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>    Ok(<span style=color:#e6db74>&#34;even steven&#34;</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    Err(<span style=color:#e6db74>&#34;odd steven&#34;</span>)
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>assert_eq!(x, Err(<span style=color:#e6db74>&#34;odd steven&#34;</span>));
</span></span></code></pre></div></article><article><a href=https://skalt.github.io/til/2022/12/10/></a><p>That you can include doc-comments in macros:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=display:flex><span>macro_rules<span style=color:#f92672>!</span> documented {
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#75715e>$(#[$outer:meta]</span>)<span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>$name</span>:<span style=color:#a6e22e>ident</span>
</span></span><span style=display:flex><span>    ) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>$(#[$outer]</span>)<span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fn</span> <span style=color:#75715e>$name</span>(<span style=color:#f92672>&amp;</span>self) {}
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>documented!(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>/// documented
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>    my_function
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>my_function(); <span style=color:#75715e>// hovering &#34;function&#34; now shows that the doc-comment is &#34;documented&#34;
</span></span></span></code></pre></div><p>h/t <a href=https://stackoverflow.com/a/33999625/6571327>https://stackoverflow.com/a/33999625/6571327</a></p></article><article><a href=https://skalt.github.io/til/2023/02/08/></a><p>That in Rust, <code>assert!</code> runs in both debug and release builds. For debug-only assertions, use <code>debug_assert!</code>. See <a href=https://doc.rust-lang.org/stable/std/macro.debug_assert.html>https://doc.rust-lang.org/stable/std/macro.debug_assert.html</a>.</p><hr><p>That in Python, you can call <code>isinstance(thing, (tuple, OfMany, DifferentClasses))</code> to check if a variable is an instance of many possible classes.
See <a href="https://docs.python.org/3/library/functions.html?highlight=isinstance#isinstance">https://docs.python.org/3/library/functions.html?highlight=isinstance#isinstance</a>.</p></article><article><a href=https://skalt.github.io/til/2023/03/04/></a><blockquote><p>The string &ldquo;0.1.12&rdquo; is a version requirement. Although it looks like a
specific version of the time crate, it actually specifies a range of versions
and allows SemVer compatible updates.</p><p>&ndash; <a href=https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html>https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html</a></p></blockquote><p>Instead, in order to lock to a specific version of a crate, you need to write
<code>= 0.1.2</code>.</p></article><article><a href=https://skalt.github.io/til/2023/05/24/></a><p>That you can destructure struct values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Point</span> {
</span></span><span style=display:flex><span>    x: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>    y: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> p <span style=color:#f92672>=</span> Point { x: <span style=color:#ae81ff>0</span>, y: <span style=color:#ae81ff>7</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> Point { x: <span style=color:#a6e22e>a</span>, y: <span style=color:#a6e22e>b</span> } <span style=color:#f92672>=</span> p;
</span></span><span style=display:flex><span>    assert_eq!(<span style=color:#ae81ff>0</span>, a);
</span></span><span style=display:flex><span>    assert_eq!(<span style=color:#ae81ff>7</span>, b);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>see <a href=https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html#destructuring-structs>https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html#destructuring-structs</a></p></article><article><a href=https://skalt.github.io/til/2023/06/18/></a><p>By default, a closure seems to live as long as its parent function <em>unless</em> you use the <code>move</code> keyword.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>unmoved</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(arg: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Fn() <span style=color:#f92672>+</span> <span style=color:#a6e22e>&#39;a</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> f <span style=color:#f92672>=</span> <span style=color:#f92672>||</span> println!(<span style=color:#e6db74>&#34;unmoved: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, arg);
</span></span><span style=display:flex><span>    f
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>moved</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(arg: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Fn() <span style=color:#f92672>+</span> <span style=color:#a6e22e>&#39;a</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> f <span style=color:#f92672>=</span> <span style=color:#66d9ef>move</span> <span style=color:#f92672>||</span> println!(<span style=color:#e6db74>&#34;moved: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, arg);
</span></span><span style=display:flex><span>    f
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    unmoved(<span style=color:#e6db74>&#34;a&#34;</span>)() <span style=color:#75715e>// does not compile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    moved(<span style=color:#e6db74>&#34;b&#34;</span>)() <span style=color:#75715e>// works fine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>&ndash; <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=abbd6cb412ea85aea82d1861c55eba35">playground link</a></p></article><article><a href=https://skalt.github.io/til/2023/06/19/></a><p>That <code>Option&lt;T></code> costs ~1x the alignment value of <code>T</code>.
I also learned <code>Vec&lt;T></code>&rsquo;s size and alignment don&rsquo;t reflect the size and alignment of <code>T</code> since the Vec is tracking an owned buffer on the heap which isn&rsquo;t counted in the Vec&rsquo;s own size.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rs data-lang=rs><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Alone8</span>(<span style=color:#66d9ef>u8</span>);         <span style=color:#75715e>// size= 1, align=1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Opt8</span>(Option<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u8</span><span style=color:#f92672>&gt;</span>);   <span style=color:#75715e>// size= 2, align=1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Vec8</span>(Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u8</span><span style=color:#f92672>&gt;</span>);      <span style=color:#75715e>// size=24; align=8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Alone64</span>(<span style=color:#66d9ef>u64</span>);       <span style=color:#75715e>// size= 8, align=8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Opt64</span>(Option<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u64</span><span style=color:#f92672>&gt;</span>); <span style=color:#75715e>// size=16, align=8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Vec64</span>(Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>u64</span><span style=color:#f92672>&gt;</span>);    <span style=color:#75715e>// size=24; align=8
</span></span></span></code></pre></div><hr><p>That Firefox bundles process and task managers for performance monitoring, available at <code>about:processes</code> and <code>about:tasks</code>, respectively
<a href=https://support.mozilla.org/en-US/kb/task-manager-tabs-or-extensions-are-slowing-firefox>https://support.mozilla.org/en-US/kb/task-manager-tabs-or-extensions-are-slowing-firefox</a></p></article></main><footer><span>© 2022-2022 CC BY-NC-SA 4.0</span></footer></body></html>