<!doctype html><html><head><meta charset=utf-8><title>Today I Learned</title>
<link rel=alternate type=application/rss+xml href=https://skalt.github.io/til/tags/python/index.xml title="Today I Learned"><link rel=stylesheet href=https://skalt.github.io/til/critical.min.31ad46bcf2679dac23a81f48b7ead9b8f05c1c77fe86709a56fcce62f2ee6107.css><style>@import "https://skalt.github.io/til/syntax-light.min.cf596d35510d6f4d08d1eec88d3d2374b3ba785ef2c68eb605930d31b93576a5.css";@media(prefers-color-scheme:dark){@import "https://skalt.github.io/til/syntax-dark.min.aa68da46c4e748d1db4b8300bf7e282aaa0befd767ada0dcc34734e9ac4e0d51.css"}</style><script src=https://skalt.github.io/til/copy_on_click.3e911aeaa98e4d249246dac78aeae0701f095f2f31738c7f930a823f012b4c2b.js integrity="sha256-PpEa6qmOTSSSRtrHiurgcB8JXy8xc4x/kwqCPwErTCs=" defer></script></head><body><header><h1><a href=https://skalt.github.io/til/>Today I Learned</a></h1><nav><a href=https://skalt.github.io/til/tags>tags</a>
<a href=https://skalt.github.io/til/search>search</a>
<a href=https://github.com/skalt/til><img alt=repo title=repo src=https://skalt.github.io/til/icon_gh.512c0dbb601adf88d85cdd317f632f04c74f76183e9dd30c331272d46a59aa13.svg>
</a><a href=https://skalt.github.io/til/tags/python/index.xml><img alt=rss title=rss src=https://skalt.github.io/til/icon_rss.2712ea2c7402d63d00f842fbc9dc64b6461012d726f7385aae61b031d1614ebd.svg></a></a></nav></header><main><h1>tags</h1><hr><article><h3><a href=https://skalt.github.io/til/2021/07/13/>2021/07/13</a></h3><p>That <code>pickle.loads(pickle.dumps(obj))</code> is faster than <code>copy.deepcopy(obj)</code>
Learned from <a href=https://twitter.com/simonw/status/1413635105755570177>Simon Willison&rsquo;s twitter</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2021/08/05/>2021/08/05</a></h3><p>that running python with the <a href=https://docs.python.org/3/using/cmdline.html#cmdoption-o><code>-O</code> flag disables <code>assert</code> statements</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2021/08/12/>2021/08/12</a></h3><p>about a new source of standard-ish python functionality: <a href=https://github.com/mahmoud/boltons>https://github.com/mahmoud/boltons</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/02/18/>2022/02/18</a></h3><p>you can import from a parent-module using <code>from ... import </code>.</p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/04/06/>2022/04/06</a></h3><p>That python f-strings can do</p><ul><li>date and time formatting: <code>f"{today:%Y-%m-%d}"</code></li><li>have a variable-debugging format: <code>f"{x = }, {y = }"</code></li><li>can use <code>__repr__</code> rather than <code>__str__</code>: <code>f"{user!r}"</code></li><li>can be nested: <code>f"output: {value:{width}.{precision}}"</code>
<a href=https://martinheinz.dev/blog/70>https://martinheinz.dev/blog/70</a></li></ul><p>Of the <code>window.prompt()</code> method:
<a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt>https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/05/05/>2022/05/05</a></h3><p>To prefer async context managers or <code>asyncio.run()</code> instead of creating+managing event loops natively.</p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/05/31/>2022/05/31</a></h3><p>That <code>sql</code> has assertions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>ASSERTION</span><span class=w> </span><span class=o>&lt;</span><span class=k>Constraint</span><span class=w> </span><span class=n>name</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CHECK</span><span class=w> </span><span class=p>(</span><span class=k>search</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=w> </span><span class=o>&lt;</span><span class=k>constraint</span><span class=w> </span><span class=n>attributes</span><span class=o>&gt;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>see <a href=https://crate.io/docs/sql-99/en/latest/chapters/20.html#create-assertion-statement>https://crate.io/docs/sql-99/en/latest/chapters/20.html#create-assertion-statement</a>.</p><p>h/t <a href=https://www.scattered-thoughts.net/log/0024/>https://www.scattered-thoughts.net/log/0024/</a> for bringing that to my attention.</p><p>Also, from the weekend: in postgres, at least, you can call <code>TABLE :table_name;</code> directly to <code>SELECT * FROM :table_name;</code></p><p>Also: how to look up a domain name from an ip:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>reverse_ip_lookup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>ip_address</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  dig -x <span class=nv>$ip_address</span> +noall +answer
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Also: how to audit AWS VPC flow logs from CloudWatch Log Insights: use the example queries in the right sidebar.</p><p>Also: python can execute .zip files directly, like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>:<span class=p>;</span> <span class=nb>echo</span> <span class=s1>&#39;print(&#34;Hello, World!&#34;)&#39;</span> &gt; __main__.py
</span></span><span class=line><span class=cl>:<span class=p>;</span> zip hello-world.zip __main__.py
</span></span><span class=line><span class=cl>:<span class=p>;</span> python3 ./hello-world.zip
</span></span><span class=line><span class=cl><span class=c1>## Hello, World!</span>
</span></span></code></pre></div><p>h/t <a href=https://pradeepchhetri.xyz/til/pythonzip/>https://pradeepchhetri.xyz/til/pythonzip/</a> for pointing that out.</p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/06/08/>2022/06/08</a></h3><p>that you can write <code>raise SomeException() from prev_exception</code>: see
<a href=https://docs.python.org/3/reference/simple_stmts.html#raise>https://docs.python.org/3/reference/simple_stmts.html#raise</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/10/19/>2022/10/19</a></h3><p>that you can easily send asyncio tasks to threads:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>asyncio.threads</span> <span class=kn>import</span> <span class=n>to_thread</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>bar</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>bar</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>to_thread</span><span class=p>(</span><span class=n>foo</span><span class=p>,</span> <span class=s2>&#34;baz&#34;</span><span class=p>))</span>
</span></span></code></pre></div></article><hr><article><h3><a href=https://skalt.github.io/til/2023/01/17/>2023/01/17</a></h3><p>that you can set <code>PYTHONDONTWRITEBYTECODE=1</code> to prevent python from writing pycs (see <a href=https://docs.python.org/3/using/cmdline.html#envvar-PYTHONDONTWRITEBYTECODE>https://docs.python.org/3/using/cmdline.html#envvar-PYTHONDONTWRITEBYTECODE</a>)</p><p>Also: that AWS SSO does SCIM actions using the <code>sso-directory:*</code> IAM prefix rather than the <code>sso:*</code> prefix.</p></article><hr><article><h3><a href=https://skalt.github.io/til/2023/02/08/>2023/02/08</a></h3><p>That in Rust, <code>assert!</code> runs in both debug and release builds. For debug-only assertions, use <code>debug_assert!</code>. See <a href=https://doc.rust-lang.org/stable/std/macro.debug_assert.html>https://doc.rust-lang.org/stable/std/macro.debug_assert.html</a>.</p><hr><p>That in Python, you can call <code>isinstance(thing, (tuple, OfMany, DifferentClasses))</code> to check if a variable is an instance of many possible classes.
See <a href="https://docs.python.org/3/library/functions.html?highlight=isinstance#isinstance">https://docs.python.org/3/library/functions.html?highlight=isinstance#isinstance</a>.</p></article><hr><article><h3><a href=https://skalt.github.io/til/2023/02/21/>2023/02/21</a></h3><p>That properties of a <code>NamedTuple</code> can have docstrings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>class</span> <span class=nc>FooBar</span><span class=p>(</span><span class=n>NamedTuple</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>foo</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Foo&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>bar</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Bar&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>As seen in <a href=https://github.com/sqlalchemy/sqlalchemy/blob/main/lib/sqlalchemy/sql/compiler.py#L348>https://github.com/sqlalchemy/sqlalchemy/blob/main/lib/sqlalchemy/sql/compiler.py#L348</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2023/11/02/>2023/11/02</a></h3><p>How to type a decorator function or decorator factory in Python: see <a href=https://mypy.readthedocs.io/en/stable/generics.html##declaring-decorators>https://mypy.readthedocs.io/en/stable/generics.html##declaring-decorators</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2024/07/05/>2024/07/05</a></h3><p>That Python mangles class attributes named like <code>__name</code>:</p><blockquote><p>Python mangles these names with the class name: if class <code>Foo</code> has an attribute named <code>__a</code>, it cannot be accessed by <code>Foo.__a</code>.
(An insistent user could still gain access by calling <code>Foo._Foo__a</code>.)
Generally, double leading underscores should be used only to avoid name conflicts with attributes in classes designed to be subclassed.</p><p>Note: there is some controversy about the use of <code>__names</code> (see below).</p><p>&ndash; <a href=https://peps.python.org/pep-0008/#method-names-and-instance-variables>https://peps.python.org/pep-0008/#method-names-and-instance-variables</a></p></blockquote><blockquote><h4 id=designing-for-inheritancehttpspepspythonorgpep-0008designing-for-inheritance><a href=https://peps.python.org/pep-0008/#designing-for-inheritance>Designing for Inheritance</a></h4><p>Always decide whether a class’s methods and instance variables
(collectively: “attributes”) should be public or non-public. If in
doubt, choose non-public; it’s easier to make it public later than to
make a public attribute non-public.</p><p>Public attributes are those that you expect unrelated clients of your
class to use, with your commitment to avoid backwards incompatible
changes. Non-public attributes are those that are not intended to be
used by third parties; you make no guarantees that non-public
attributes won’t change or even be removed.</p><p>We don’t use the term “private” here, since no attribute is really
private in Python (without a generally unnecessary amount of work).</p><p>Another category of attributes are those that are part of the
“subclass API” (often called “protected” in other languages). Some
classes are designed to be inherited from, either to extend or modify
aspects of the class’s behavior. When designing such a class, take
care to make explicit decisions about which attributes are public,
which are part of the subclass API, and which are truly only to be
used by your base class.</p><p>With this in mind, here are the Pythonic guidelines:</p><ul><li><p>Public attributes should have no leading underscores.</p></li><li><p>If your public attribute name collides with a reserved keyword,
append a single trailing underscore to your attribute name. This is
preferable to an abbreviation or corrupted spelling. (However,
notwithstanding this rule, ‘cls’ is the preferred spelling for any
variable or argument which is known to be a class, especially the
first argument to a class method.)</p><p>Note 1: See the argument name recommendation above for class methods.</p></li><li><p>For simple public data attributes, it is best to expose just the
attribute name, without complicated accessor/mutator methods. Keep
in mind that Python provides an easy path to future enhancement,
should you find that a simple data attribute needs to grow
functional behavior. In that case, use properties to hide
functional implementation behind simple data attribute access
syntax.</p><p>Note 1: Try to keep the functional behavior side-effect free,
although side-effects such as caching are generally fine.</p><p>Note 2: Avoid using properties for computationally expensive
operations; the attribute notation makes the caller believe that
access is (relatively) cheap.</p></li><li><p>If your class is intended to be subclassed, and you have attributes
that you do not want subclasses to use, consider naming them with
double leading underscores and no trailing underscores. This
invokes Python’s name mangling algorithm, where the name of the
class is mangled into the attribute name. This helps avoid
attribute name collisions should subclasses inadvertently contain
attributes with the same name.</p><p>Note 1: Note that only the simple class name is used in the mangled
name, so if a subclass chooses both the same class name and attribute
name, you can still get name collisions.</p><p>Note 2: Name mangling can make certain uses, such as debugging and
<code>__getattr__()</code>, less convenient. However the name mangling
algorithm is well documented and easy to perform manually.</p><p>Note 3: Not everyone likes name mangling. Try to balance the
need to avoid accidental name clashes with potential use by
advanced callers.</p></li></ul><p>&ndash; <a href=https://peps.python.org/pep-0008/#designing-for-inheritance>https://peps.python.org/pep-0008/#designing-for-inheritance</a></p></blockquote></article><hr><article><h3><a href=https://skalt.github.io/til/2024/08/04/>2024/08/04</a></h3><p>That if you specify an <code>Entry-points</code> key in python <code>.dist-info/METADATA</code>, python will create command-line wrappers for your scripts.</p><p>See <a href=https://packaging.python.org/en/latest/specifications/entry-points/>https://packaging.python.org/en/latest/specifications/entry-points/</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2024/08/11/>2024/08/11</a></h3><p>That virtualenvs may contain two files that alter the <code>sys.path</code> outside of the <code>$PYTHONPATH</code> variable:</p><ol><li><code>.venv/pyvenv.cfg</code> (see <a href=https://docs.python.org/3/library/sys_path_init.html#virtual-environments>https://docs.python.org/3/library/sys_path_init.html#virtual-environments</a>)</li><li><code>.venv/python3.*/site-packages/*.pth</code> (see <a href=https://docs.python.org/3/library/sys_path_init.html#pth-files>https://docs.python.org/3/library/sys_path_init.html#pth-files</a>)</li></ol></article><hr><article><h3><a href=https://skalt.github.io/til/2024/08/12/>2024/08/12</a></h3><p>That python dicts have an upsert method: <a href=https://docs.python.org/3/library/stdtypes.html#dict.setdefault>https://docs.python.org/3/library/stdtypes.html#dict.setdefault</a></p></article></main><footer><span>© 2022-2022 CC BY-NC-SA 4.0</span></footer></body></html>