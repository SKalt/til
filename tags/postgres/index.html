<!doctype html><html><head><meta charset=utf-8><title>Today I Learned</title><link rel=alternate type=application/rss+xml href=https://skalt.github.io/til/tags/postgres/index.xml title="Today I Learned"><link rel=stylesheet href=https://skalt.github.io/til/critical.min.594b5b7a363d42cef2053010611ce4d2364196b08b295f8bf7199f9406b595e4.css></head><body><header><h1><a href=https://skalt.github.io/til/>Today I Learned</a></h1><nav><a href=https://skalt.github.io/til/tags>tags</a>
<a href=https://skalt.github.io/til/search>search</a>
<a href=https://github.com/skalt/til><img alt=repo title=repo src=https://skalt.github.io/til/icon_gh.512c0dbb601adf88d85cdd317f632f04c74f76183e9dd30c331272d46a59aa13.svg></a>
<a href=https://skalt.github.io/til/tags/postgres/index.xml><img alt=rss title=rss src=https://skalt.github.io/til/icon_rss.2712ea2c7402d63d00f842fbc9dc64b6461012d726f7385aae61b031d1614ebd.svg></a></a></nav></header><main><article><a href=https://skalt.github.io/til/2021/10/01/></a><p>That there&rsquo;s a postgres keyword <code>DEALLOCATE</code> to remove prepared statements from memory: <a href=https://www.postgresql.org/docs/current/sql-deallocate.html>https://www.postgresql.org/docs/current/sql-deallocate.html</a></p></article><article><a href=https://skalt.github.io/til/2021/11/03/></a><p>That</p><ol><li><blockquote><p>There are two accepted formats for these strings: plain keyword/value strings and URIs.
URIs generally follow RFC 3986, except that multi-host connection strings are allowed.</p><p>&ndash; <a href=https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING>https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING</a></p></blockquote></li><li>you can pass a <code>application_name</code> parameter to a connection string &ndash; <a href=https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-APPLICATION-NAME>https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-APPLICATION-NAME</a></li></ol></article><article><a href=https://skalt.github.io/til/2021/11/29/></a><p>that there&rsquo;s a <code>pg_sleep(seconds)</code> function: see <a href=https://til.hashrocket.com/posts/8a6f68519d-sleeping-in-postgresql>https://til.hashrocket.com/posts/8a6f68519d-sleeping-in-postgresql</a></p></article><article><a href=https://skalt.github.io/til/2022/01/09/></a><p>1: That you can set statement timeouts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>DATABASE</span> mydatabase <span style=color:#66d9ef>SET</span> statement_timeout <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;60s&#39;</span>;
</span></span></code></pre></div><p>Source: <a href=https://blog.crunchydata.com/blog/five-tips-for-a-healthier-postgres-database-in-the-new-year>https://blog.crunchydata.com/blog/five-tips-for-a-healthier-postgres-database-in-the-new-year</a></p><p>2: that you can query your cache and index hit metrics (<a href=https://blog.crunchydata.com/blog/cleaning-up-your-postgres-database>src</a>)</p><p>3: writes to indexed columns don&rsquo;t necessarily update indices:</p><blockquote><p>If an indexed column has to have new values inserted, or existing values updated or deleted, the corresponding index does get updated as well. Ironically, that might make queries take more time to evaluate. If write operations are frequently run against a particular column then you may need to more carefully evaluate creating an index here.</p><p>If there&rsquo;s only one thing you take away from this blog post, I hope it&rsquo;s this: success with indexes will involve some planning, investigation, and maintenance!</p><p>&ndash; <a href=https://blog.crunchydata.com/blog/three-easy-things-to-remember-about-postgres-indexes>https://blog.crunchydata.com/blog/three-easy-things-to-remember-about-postgres-indexes</a></p></blockquote></article><article><a href=https://skalt.github.io/til/2022/05/04/></a><p>Not to use <code>BETWEEN</code> for timestamps
Not to use <code>char(n)</code>, or <code>varchar(n)</code>, since they&rsquo;re not natively fixed-width and will defy expectations.
See <a href="https://wiki.postgresql.org/wiki/Don't_Do_This">https://wiki.postgresql.org/wiki/Don't_Do_This</a></p><p>Also, I learned that you can&rsquo;t run <code>chsh(1)</code> with <code>sudo</code>; <code>chsh</code> needs to run as the user who&rsquo;s changing their shell.</p></article><article><a href=https://skalt.github.io/til/2022/05/09/></a><ul><li><p>that <code>sudo</code> can be configured with the <code>visudo</code> command <em>and</em> that sudo can produce audit logs.
See <a href=https://www.sudo.ws/posts/2022/05/sudo-for-blue-teams-how-to-control-and-log-better/>https://www.sudo.ws/posts/2022/05/sudo-for-blue-teams-how-to-control-and-log-better/</a></p></li><li><p>that there&rsquo;s an <a href=https://developer.mozilla.org/en-US/docs/Web/API/Element/closest><code>Element.closest(selector)</code></a> method, which means you can run this function to set the url to the closest link to an element:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>((<span style=color:#a6e22e>el</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>closest</span>(<span style=color:#e6db74>&#34;[id]&#34;</span>)<span style=color:#f92672>?</span>.<span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>id</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>hash</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>})(<span style=color:#a6e22e>$0</span>);
</span></span></code></pre></div></li><li><p>that you can use</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>  <span style=color:#66d9ef>SELECT</span> <span style=color:#75715e>/*...*/</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> one_table
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>JOIN</span> other_table
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>USING</span> (common_column)
</span></span></code></pre></div><p>as shorthand for <code>one_table.common_column = other_table.common_column</code>.
See <a href=https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM>https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM</a></p></li></ul></article><article><a href=https://skalt.github.io/til/2022/06/01/></a><p>That <code>pg_dumpall</code> exists.
That you need to use <code>pg_dumpall</code> to dump tablespaces, roles, and subscriptions.
That <code>pg_dumpall</code> will dump the <code>postgres</code> role by default, causing resultant dump to fail to restore.
Fortunately, I&rsquo;m able to <code>grep -ve '^CREATE ROLE postgres</code></p></article><article><a href=https://skalt.github.io/til/2022/11/14/></a><p>That <code>pg_catalog.pg_shdepend</code> exists, and &ldquo;records the dependency relationships between database objects and shared objects, such as roles.&rdquo;
See <a href=https://www.postgresql.org/docs/current/catalog-pg-shdepend.html>https://www.postgresql.org/docs/current/catalog-pg-shdepend.html</a></p></article></main><footer><span>Â© 2022-2022 CC BY-NC-SA 4.0</span></footer></body></html>