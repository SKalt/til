<!doctype html><html><head><meta charset=utf-8><title>Today I Learned</title><link rel=alternate type=application/rss+xml href=https://skalt.github.io/til/tags/js/index.xml title="Today I Learned"><link rel=stylesheet href=https://skalt.github.io/til/critical.min.31ad46bcf2679dac23a81f48b7ead9b8f05c1c77fe86709a56fcce62f2ee6107.css><style>@import "https://skalt.github.io/til/syntax-light.min.cf596d35510d6f4d08d1eec88d3d2374b3ba785ef2c68eb605930d31b93576a5.css";@media(prefers-color-scheme:dark){@import "https://skalt.github.io/til/syntax-dark.min.aa68da46c4e748d1db4b8300bf7e282aaa0befd767ada0dcc34734e9ac4e0d51.css"}</style><script src=https://skalt.github.io/til/copy_on_click.3e911aeaa98e4d249246dac78aeae0701f095f2f31738c7f930a823f012b4c2b.js integrity="sha256-PpEa6qmOTSSSRtrHiurgcB8JXy8xc4x/kwqCPwErTCs=" defer></script></head><body><header><h1><a href=https://skalt.github.io/til/>Today I Learned</a></h1><nav><a href=https://skalt.github.io/til/tags>tags</a>
<a href=https://skalt.github.io/til/search>search</a>
<a href=https://github.com/skalt/til><img alt=repo title=repo src=https://skalt.github.io/til/icon_gh.512c0dbb601adf88d85cdd317f632f04c74f76183e9dd30c331272d46a59aa13.svg>
</a><a href=https://skalt.github.io/til/tags/js/index.xml><img alt=rss title=rss src=https://skalt.github.io/til/icon_rss.2712ea2c7402d63d00f842fbc9dc64b6461012d726f7385aae61b031d1614ebd.svg></a></a></nav></header><main><h1>tags</h1><hr><article><h3><a href=https://skalt.github.io/til/2021/07/24/>2021/07/24</a></h3><p><a href=https://web.dev/fetch-upload-streaming/#previously-on-the-exciting-adventures-of-fetch-streams>How to stream large responses using the Javascript <code>Fetch</code> API:</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>reader</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>getReader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>value</span><span class=p>,</span> <span class=nx>done</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>reader</span><span class=p>.</span><span class=nx>read</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>done</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Received&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Response fully received&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>Also: <a href=https://linuxhandbook.com/login-shell/>the circumstances under which ~/.*profile files are run: only if you log in.</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/03/08/>2022/03/08</a></h3><p>random: turns out HTML comments are valid line-comments in JS: <a href=https://smitop.com/post/js-html-comments/>https://smitop.com/post/js-html-comments/</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/04/06/>2022/04/06</a></h3><p>That python f-strings can do</p><ul><li>date and time formatting: <code>f"{today:%Y-%m-%d}"</code></li><li>have a variable-debugging format: <code>f"{x = }, {y = }"</code></li><li>can use <code>__repr__</code> rather than <code>__str__</code>: <code>f"{user!r}"</code></li><li>can be nested: <code>f"output: {value:{width}.{precision}}"</code>
<a href=https://martinheinz.dev/blog/70>https://martinheinz.dev/blog/70</a></li></ul><p>Of the <code>window.prompt()</code> method:
<a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt>https://developer.mozilla.org/en-US/docs/Web/API/Window/prompt</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2022/05/09/>2022/05/09</a></h3><ul><li><p>that <code>sudo</code> can be configured with the <code>visudo</code> command <em>and</em> that sudo can produce audit logs.
See <a href=https://www.sudo.ws/posts/2022/05/sudo-for-blue-teams-how-to-control-and-log-better/>https://www.sudo.ws/posts/2022/05/sudo-for-blue-teams-how-to-control-and-log-better/</a></p></li><li><p>that there&rsquo;s an <a href=https://developer.mozilla.org/en-US/docs/Web/API/Element/closest><code>Element.closest(selector)</code></a> method, which means you can run this function to set the url to the closest link to an element:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>((</span><span class=nx>el</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>el</span><span class=p>.</span><span class=nx>closest</span><span class=p>(</span><span class=s2>&#34;[id]&#34;</span><span class=p>)</span><span class=o>?</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>id</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=nx>location</span><span class=p>.</span><span class=nx>hash</span> <span class=o>=</span> <span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})(</span><span class=nx>$0</span><span class=p>);</span>
</span></span></code></pre></div></li><li><p>that you can use</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=cm>/*...*/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>one_table</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>JOIN</span><span class=w> </span><span class=n>other_table</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>USING</span><span class=w> </span><span class=p>(</span><span class=n>common_column</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>as shorthand for <code>one_table.common_column = other_table.common_column</code>.
See <a href=https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM>https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM</a></p></li></ul></article><hr><article><h3><a href=https://skalt.github.io/til/2022/06/02/>2022/06/02</a></h3><p>How to create a JS <code>BigInt</code> value:</p><blockquote><p>A BigInt value, also sometimes just called a BigInt, is a bigint primitive, created by appending n to the end of an integer literal, or by calling the BigInt() constructor (but without the new operator) and giving it an integer value or string value.
&ndash; <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt>https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt</a></p></blockquote></article><hr><article><h3><a href=https://skalt.github.io/til/2022/06/14/>2022/06/14</a></h3><p>That <code>Array.sort</code> separates floats and ints:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>x</span> <span class=o>=</span> <span class=p>[</span><span class=mi>8</span><span class=p>,</span> <span class=mf>7.4</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>11</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1>// [ 8, 7.4, 14, 13, 12, 11 ]
</span></span></span><span class=line><span class=cl><span class=nx>x</span><span class=p>.</span><span class=nx>sort</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// [ 11, 12, 13, 14, 7.4, 8 ]
</span></span></span><span class=line><span class=cl><span class=nx>x</span><span class=p>.</span><span class=nx>sort</span><span class=p>().</span><span class=nx>reverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// [ 8, 7.4, 14, 13, 12, 11 ]
</span></span></span></code></pre></div></article><hr><article><h3><a href=https://skalt.github.io/til/2022/09/20/>2022/09/20</a></h3><p>A hack to detect if an element is visible/not:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isVisible</span> <span class=o>=</span> <span class=p>(</span><span class=nx>el</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>el</span><span class=p>.</span><span class=nx>offsetWidth</span> <span class=o>||</span> <span class=nx>el</span><span class=p>.</span><span class=nx>offsetHeight</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span></code></pre></div><p>see <a href=https://stackoverflow.com/questions/1343237/how-to-check-elements-visibility-via-javascript>https://stackoverflow.com/questions/1343237/how-to-check-elements-visibility-via-javascript</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2023/08/09/>2023/08/09</a></h3><p>That you can cancel/reset timeouts in JS using <a href=https://developer.mozilla.org/en-US/docs/Web/API/clearTimeout><code>clearTimeout</code></a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2023/10/18/>2023/10/18</a></h3><blockquote><p>RFCs are labeled with different statuses:</p><ol><li>Internet Standard (e.g. <a href=https://datatracker.ietf.org/doc/html/rfc9112/>HTTP/1.1</a>)</li><li>Proposed Standard (e.g. <a href=https://datatracker.ietf.org/doc/html/rfc9114/>HTTP/3</a>, <a href=https://datatracker.ietf.org/doc/html/rfc9113>HTTP/2</a>)</li><li>Best Current Practice</li><li>Experimental</li><li>Informational</li><li>Historic</li></ol><p>[&mldr;]</p><p>RFCs usually begin as Internet-Drafts (I-Ds) written by an individual or a small group.
In the IETF, these are then usually adopted by a working group, and improved and revised.</p><p>&ndash; <a href=https://www.ietf.org/standards/rfcs/>https://www.ietf.org/standards/rfcs/</a></p></blockquote><hr><blockquote><p>Class fields are public by default, but private class members can be created by using a hash <code>#</code> prefix.
The privacy encapsulation of these class features is enforced by JavaScript itself.</p><p>&ndash; <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields>https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields</a></p></blockquote></article><hr><article><h3><a href=https://skalt.github.io/til/2023/10/31/>2023/10/31</a></h3><p>That POSIX shell has configuration option, <a href=https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_25_03><code>set -a</code> or <code>set -o allexport</code></a> that exports all assigned variables.
This simplifies using <code>.env</code> files in <code>.envrc</code> files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># evaluate a .env file, if it exists</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -f .env <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>set</span> -a <span class=c1># assigning a variable exports the variable</span>
</span></span><span class=line><span class=cl>  <span class=c1># shellcheck disable=SC1091</span>
</span></span><span class=line><span class=cl>  <span class=nb>source</span> .env
</span></span><span class=line><span class=cl>  <span class=nb>set</span> +a
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><hr><p>That JS has a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/raw><code>String.raw</code></a> <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates>template literal tag function</a> that unescapes escape sequences in a backtick-string:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>String</span><span class=p>.</span><span class=nx>raw</span><span class=sb>`\t\r\n`</span> <span class=c1>// =&gt; &#34;\\t\\r\\n&#34;
</span></span></span></code></pre></div></article><hr><article><h3><a href=https://skalt.github.io/til/2025/01/26/>2025/01/26</a></h3><p>That <code>String.split</code> doesn&rsquo;t need parentheses:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=s2>&#34;a b&#34;</span><span class=p>.</span><span class=nx>split</span><span class=sb>` `</span> <span class=c1>// [&#34;a&#34;, &#34;b&#34;]
</span></span></span></code></pre></div><p>See <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates>https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates</a></p></article><hr><article><h3><a href=https://skalt.github.io/til/2025/08/08/>2025/08/08</a></h3><p>That node.js bundles a jest-like test runner since 1.20: <a href=https://nodejs.org/api/test.html#test-runner>https://nodejs.org/api/test.html#test-runner</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>test</span><span class=p>,</span> <span class=nx>describe</span><span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;node:test&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;behavior&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=p>(</span><span class=s2>&#34;case&#34;</span><span class=p>,</span> <span class=nx>t</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>node --test
</span></span></code></pre></div><p>H/T <a href=https://kashw1n.com/blog/nodejs-2025/#3-built-in-testing-professional-testing-without-external-dependencies>https://kashw1n.com/blog/nodejs-2025/#3-built-in-testing-professional-testing-without-external-dependencies</a> for pointing this out.</p></article><hr><article><h3><a href=https://skalt.github.io/til/2025/12/13/>2025/12/13</a></h3><blockquote><p>Since May 2024, this feature works across the latest devices and browser versions.
The light-dark() CSS function enables setting two colors for a property - returning one of the two colors options by detecting if the developer has set a light or dark color scheme or the user has requested light or dark color theme - without needing to encase the theme colors within a prefers-color-scheme media feature query.</p><p>&ndash; <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Values/color_value/light-dark>https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Values/color_value/light-dark</a></p></blockquote><p>Also, you can detecte system-level dark mode (and listen for changes) using</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>query</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>matchMedia</span><span class=p>(</span><span class=s2>&#34;(prefers-color-scheme: dark)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isDark</span>: <span class=kt>boolean</span> <span class=o>=</span> <span class=nx>query</span><span class=p>.</span><span class=nx>matches</span> <span class=err>#</span> <span class=kr>boolean</span>
</span></span><span class=line><span class=cl><span class=nx>query</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;change&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=o>:</span> <span class=kr>boolean</span> <span class=o>=&gt;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>matches</span><span class=p>)</span>
</span></span></code></pre></div><p>(h/t <a href=https://robkendal.co.uk/blog/2024-11-21-detecting-os-level-dark-mode/>https://robkendal.co.uk/blog/2024-11-21-detecting-os-level-dark-mode/</a>)</p></article></main><footer><span>Â© 2022-2022 CC BY-NC-SA 4.0</span></footer></body></html>