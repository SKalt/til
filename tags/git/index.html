<!doctype html><html><head><meta charset=utf-8><title>Today I Learned</title>
<link rel=alternate type=application/rss+xml href=https://skalt.github.io/til/tags/git/index.xml title="Today I Learned"><link rel=stylesheet href=https://skalt.github.io/til/critical.min.31ad46bcf2679dac23a81f48b7ead9b8f05c1c77fe86709a56fcce62f2ee6107.css><style>@import "https://skalt.github.io/til/syntax-light.min.cf596d35510d6f4d08d1eec88d3d2374b3ba785ef2c68eb605930d31b93576a5.css";@media(prefers-color-scheme:dark){@import "https://skalt.github.io/til/syntax-dark.min.aa68da46c4e748d1db4b8300bf7e282aaa0befd767ada0dcc34734e9ac4e0d51.css"}</style><script src=https://skalt.github.io/til/copy_on_click.3e911aeaa98e4d249246dac78aeae0701f095f2f31738c7f930a823f012b4c2b.js integrity="sha256-PpEa6qmOTSSSRtrHiurgcB8JXy8xc4x/kwqCPwErTCs=" defer></script></head><body><header><h1><a href=https://skalt.github.io/til/>Today I Learned</a></h1><nav><a href=https://skalt.github.io/til/tags>tags</a>
<a href=https://skalt.github.io/til/search>search</a>
<a href=https://github.com/skalt/til><img alt=repo title=repo src=https://skalt.github.io/til/icon_gh.512c0dbb601adf88d85cdd317f632f04c74f76183e9dd30c331272d46a59aa13.svg>
</a><a href=https://skalt.github.io/til/tags/git/index.xml><img alt=rss title=rss src=https://skalt.github.io/til/icon_rss.2712ea2c7402d63d00f842fbc9dc64b6461012d726f7385aae61b031d1614ebd.svg></a></a></nav></header><main><article><a href=https://skalt.github.io/til/2021/07/31/></a><p><a href=https://git-scm.com/docs/git-grep>That you can use <code>git grep</code></a> to search for a string in a git repo.</p></article><article><a href=https://skalt.github.io/til/2021/12/01/></a><p>that you can write any file in your git history using <code>git show &lt;ref>:&lt;path></code>.</p><p>See <a href=https://juplo.de/cat-any-file-in-any-commit-with-git/>https://juplo.de/cat-any-file-in-any-commit-with-git/</a></p></article><article><a href=https://skalt.github.io/til/2022/03/06/></a><p>About <code>git-sparse-checkout</code>:</p><ul><li><a href=https://linuxhint.com/what-is-git-sparse-checkout/>https://linuxhint.com/what-is-git-sparse-checkout/</a></li><li><a href=https://git-scm.com/docs/git-sparse-checkout>https://git-scm.com/docs/git-sparse-checkout</a></li></ul><p>The general script for doing a sparse checkout is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nv>git_url</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>git_url</span><span class=p>:?required</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>target_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>target_dir</span><span class=p>:?required</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>is_git_dir<span class=o>()</span> <span class=o>{</span> git rev-parse<span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>init<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  mkdir -p <span class=s2>&#34;</span><span class=nv>$target_dir</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$target_dir</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> ! is_git_dir<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    git init <span class=o>&amp;&amp;</span> git remote add -f origin <span class=s2>&#34;</span><span class=nv>$git_url</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  git config core.sparseCheckout <span class=nb>true</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>    git sparse-checkout init <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>    git sparse-checkout <span class=nb>set</span> <span class=nb>test</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>    git pull origin master
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>see also: <a href=https://about.gitlab.com/blog/2020/03/13/partial-clone-for-massive-repositories/>https://about.gitlab.com/blog/2020/03/13/partial-clone-for-massive-repositories/</a></p></article><article><a href=https://skalt.github.io/til/2022/08/06/></a><p>How to consistently establish relative symlinks within a git repo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$target_dir</span><span class=s2>&#34;</span> <span class=c1># the directory in which you want to create the symlink</span>
</span></span><span class=line><span class=cl>ln -s ../relative/path/to/source.file ./symlink.name
</span></span></code></pre></div><p><a href=https://stackoverflow.com/a/15465514/6571327>https://stackoverflow.com/a/15465514/6571327</a></p></article><article><a href=https://skalt.github.io/til/2023/02/01/></a><p><code>git restore</code> exists, and works like a more destructive <code>git stash</code></p><p>See <a href=https://git-scm.com/docs/git-restore>https://git-scm.com/docs/git-restore</a></p></article><article><a href=https://skalt.github.io/til/2023/03/02/></a><p>that there&rsquo;s a <code>git commit --trailer &lt;token>:&lt;value></code> flag.</p><p><a href=https://git-scm.com/docs/git-commit#Documentation/git-commit.txt---trailerlttokengtltvaluegt>https://git-scm.com/docs/git-commit#Documentation/git-commit.txt---trailerlttokengtltvaluegt</a></p></article><article><a href=https://skalt.github.io/til/2023/03/09/></a><p>This was a bit of a rollercoaster morning:
(1) I tried <code>git worktree add $branch</code>, and it was pretty convenient!
(2) until I got a pre-commit error, then I got <code>error: unable to read $HASH</code> on <code>git status</code>
(3) which led me to discover <code>git fsck --full --name-objects</code>, which is currently yelling about <code>error: $HASH: invalid sha1 pointer in cache-tree</code></p></article><article><a href=https://skalt.github.io/til/2023/05/16/></a><p>That there are instances where a git commit-message can start with a <code>#</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>set</span> -eu
</span></span><span class=line><span class=cl><span class=nv>experiment</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>mkdtemp -d<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$experiment</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git init#
</span></span><span class=line><span class=cl>touch readme <span class=o>&amp;&amp;</span> git add readme
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;# not a comment, apparently&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>actual</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>cat ./.git/COMMIT_EDITMSG<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>expected</span><span class=o>=</span><span class=s2>&#34;# not a comment, apparently&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>test</span> <span class=s2>&#34;</span><span class=nv>$actual</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=nv>$expected</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git log
</span></span><span class=line><span class=cl><span class=c1># &lt;hash&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># # not a comment, apparently</span>
</span></span></code></pre></div></article><article><a href=https://skalt.github.io/til/2023/07/30/></a><h1 id=getting-the-top-level-directory-of-the-relevant-git-worktree>Getting the top-level directory of the relevant git worktree</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># set up a dummy repo</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -euo pipefail
</span></span><span class=line><span class=cl><span class=nv>experiment_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>mktemp -d --tmpdir test_repo.XXX<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git clone --recurse-submodules git@github.com:SKalt/dummy_repo.git <span class=s2>&#34;</span><span class=nv>$experiment_dir</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$experiment_dir</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>git pull --recurse-submodules<span class=o>=</span>yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git checkout -b brnch <span class=o>&amp;&amp;</span> git checkout - <span class=c1># set up a dummy branch</span>
</span></span><span class=line><span class=cl>git worktree add wrktr brnch <span class=c1># add a wortree</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> wrktr <span class=o>&amp;&amp;</span>  git submodule update --init --recursive <span class=c1># init the recursive submodules in the worktree</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tree .
</span></span></code></pre></div><pre tabindex=0><code>.
├── LICENSE
├── nested
│   └── file.txt
├── README.md
├── submod
│   ├── LICENSE
│   ├── nested
│   │   └── file.txt
│   ├── README.md
│   └── submod
│       ├── LICENSE
│       ├── nested
│       │   └── file.txt
│       └── README.md
└── wrktr
    ├── LICENSE
    ├── nested
    │   └── file.txt
    ├── README.md
    └── submod
        ├── LICENSE
        ├── nested
        │   └── file.txt
        ├── README.md
        └── submod
            ├── LICENSE
            ├── nested
            │   └── file.txt
            └── README.md

11 directories, 18 files
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tree .git
</span></span></code></pre></div><pre tabindex=0><code>./.git
├── branches
├── config
├── description
├── HEAD
├── hooks/...
├── index
├── info/...
├── logs/...
├── modules
│   └── submod
│       ├── branches
│       ├── config
│       ├── description
│       ├── HEAD
│       ├── hooks/...
│       ├── index
│       ├── info/...
│       ├── logs/...
│       ├── modules
│       │   └── submod
│       │       ├── branches
│       │       ├── config # &lt;- contains relative path in core.worktree
│       │       ├── description
│       │       ├── HEAD
│       │       ├── hooks/...
│       │       ├── index
│       │       ├── info/...
│       │       ├── logs/...
│       │       ├── objects/...
│       │       ├── packed-refs
│       │       └── refs/...
│       ├── objects/...
│       ├── packed-refs
│       └── refs/...
├── objects/...
├── packed-refs
├── refs
│   ├── heads
│   │   ├── brnch
│   │   └── main
│   ├── remotes
│   │   └── origin
│   │       └── HEAD
│   └── tags
└── worktrees
    └── wrktr
        ├── commondir
        ├── gitdir
        ├── HEAD
        ├── index
        ├── logs
        │   └── HEAD
        ├── modules
        │   └── submod
        │       ├── branches
        │       ├── config
        │       ├── description
        │       ├── HEAD
        │       ├── hooks/...
        │       ├── index
        │       ├── info/...
        │       ├── logs/...
        │       ├── modules
        │       │   └── submod
        │       │       ├── branches
        │       │       ├── config
        │       │       ├── description
        │       │       ├── HEAD
        │       │       ├── hooks/...
        │       │       ├── index
        │       │       ├── info/...
        │       │       ├── logs/...
        │       │       ├── objects/...
        │       │       ├── packed-refs
        │       │       └── refs/...
        │       ├── objects/...
        │       ├── packed-refs
        │       └── refs/...
        └── ORIG_HEAD

91 directories, 133 files
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>args</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    --git-common-dir
</span></span><span class=line><span class=cl>    --git-dir
</span></span><span class=line><span class=cl>    --is-inside-git-dir
</span></span><span class=line><span class=cl>    --is-inside-work-tree
</span></span><span class=line><span class=cl>    --show-toplevel
</span></span><span class=line><span class=cl><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>padding<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>delimiter</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=c1># must be 1ch</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>message</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>width</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>3</span><span class=k>:-</span><span class=nv>78</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>printf</span> -- <span class=s2>&#34;</span><span class=si>${</span><span class=nv>delimiter</span><span class=si>}</span><span class=s2>%.0s&#34;</span> <span class=k>$(</span>seq <span class=m>0</span> <span class=k>$((</span><span class=nv>$width</span> <span class=o>-</span> <span class=si>${#</span><span class=nv>message</span><span class=si>}</span><span class=k>)))</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>header<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>message</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>printf</span> <span class=s2>&#34;%s &#34;</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span>
</span></span><span class=line><span class=cl>    <span class=nb>printf</span> <span class=s2>&#34;%s&#34;</span> <span class=s2>&#34;</span><span class=nv>$message</span><span class=s2>&#34;</span><span class=p>;</span> padding <span class=s2>&#34;#&#34;</span> <span class=s2>&#34;</span><span class=nv>$message</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>echo</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>indent<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    padding <span class=s2>&#34; &#34;</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> 22<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>printf</span> <span class=s2>&#34;%s = &#34;</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>explore<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>to_explore</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$to_explore</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        header <span class=s2>&#34;</span><span class=nv>$to_explore</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> arg in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>args</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>            indent <span class=s2>&#34;</span><span class=nv>$arg</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            git --no-pager rev-parse <span class=s2>&#34;</span><span class=nv>$arg</span><span class=s2>&#34;</span> 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>||</span> true<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        indent <span class=s2>&#34;config#core.worktree&#34;</span>
</span></span><span class=line><span class=cl>        git --no-pager config core.worktree <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;&lt;missing&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        indent <span class=s2>&#34;./config#core.worktree&#34;</span> <span class=m>22</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> -f ./config <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            git --no-pager config --file <span class=si>${</span><span class=nv>PWD</span><span class=si>}</span>/config core.worktree <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;&lt;missing&gt;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>        indent <span class=s2>&#34;./gitdir&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> -f ./gitdir <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            cat ./gitdir<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=nb>echo</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=p>|</span> sed <span class=s1>&#39;s/^/# /g&#39;</span> <span class=p>|</span> sed <span class=s2>&#34;s#</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>#\${PWD}#g&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>paths_to_explore</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/nested&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/.git&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/.git/worktrees&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/.git/worktrees/wrktr&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/.git/worktrees/wrktr/modules/submod&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/wrktr&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/wrktr/submod&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/submod&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/.git/modules/submod&#34;</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> p in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>paths_to_explore</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span> explore <span class=s2>&#34;</span><span class=nv>$p</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>done</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD} ############################################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = .git</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = .git</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = true</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/nested #####################################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = ../.git</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = ${PWD}/.git</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = true</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/.git #######################################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = true</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = false</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = fatal: this operation must be run in a work tree</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/.git/worktrees #############################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = ${PWD}/.git</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = ${PWD}/.git</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = true</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = false</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = fatal: this operation must be run in a work tree</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/.git/worktrees/wrktr #######################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = ${PWD}/.git</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = true</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = false</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = fatal: this operation must be run in a work tree</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir = ${PWD}/wrktr/.git</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/.git/worktrees/wrktr/modules/submod ########################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = false</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}/wrktr/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = ../../../../../wrktr/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree = ../../../../../wrktr/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/wrktr ######################################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = ${PWD}/.git</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = ${PWD}/.git/worktrees/wrktr</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = true</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}/wrktr</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = &lt;missing&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/wrktr/submod ###############################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = ${PWD}/.git/worktrees/wrktr/modules/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = ${PWD}/.git/worktrees/wrktr/modules/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = true</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}/wrktr/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = ../../../../../wrktr/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/submod #####################################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = ${PWD}/.git/modules/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = ${PWD}/.git/modules/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = true</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = ../../../submod</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree =</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ${PWD}/.git/modules/submod ########################################</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#        --git-common-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#               --git-dir = .</span>
</span></span><span class=line><span class=cl><span class=c1>#     --is-inside-git-dir = false</span>
</span></span><span class=line><span class=cl><span class=c1>#   --is-inside-work-tree = false</span>
</span></span><span class=line><span class=cl><span class=c1>#         --show-toplevel = ${PWD}/submod</span>
</span></span><span class=line><span class=cl><span class=c1>#    config#core.worktree = ../../../submod</span>
</span></span><span class=line><span class=cl><span class=c1>#  ./config#core.worktree = ../../../submod</span>
</span></span><span class=line><span class=cl><span class=c1>#                ./gitdir =</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>explore_tab<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>to_explore</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$to_explore</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>printf</span> <span class=s1>&#39;|`%s`&#39;</span> <span class=s2>&#34;</span><span class=nv>$to_explore</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> arg in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>args</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>            <span class=nv>_result</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>git --no-pager rev-parse <span class=s2>&#34;</span><span class=nv>$arg</span><span class=s2>&#34;</span> 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>||</span> <span class=nb>true</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>printf</span> <span class=s1>&#39;|`%s`&#39;</span> <span class=s2>&#34;</span><span class=nv>$_result</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>done</span>
</span></span><span class=line><span class=cl>        <span class=c1># config#core.worktree</span>
</span></span><span class=line><span class=cl>        <span class=nb>printf</span> <span class=s1>&#39;|`%s`&#39;</span> <span class=s2>&#34;</span><span class=k>$(</span>git --no-pager config core.worktree <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;&lt;missing&gt;&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># ./config#core.worktree</span>
</span></span><span class=line><span class=cl>        <span class=nb>printf</span> <span class=s1>&#39;|&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> -f ./config <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            <span class=nb>printf</span> <span class=s1>&#39;`%s`&#39;</span> <span class=s2>&#34;</span><span class=k>$(</span>
</span></span><span class=line><span class=cl>                git --no-pager config --file <span class=si>${</span><span class=nv>PWD</span><span class=si>}</span>/config core.worktree <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;&lt;missing&gt;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>        <span class=c1># ./gitdir</span>
</span></span><span class=line><span class=cl>        <span class=nb>printf</span> <span class=s2>&#34;|&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> -f ./gitdir <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>            <span class=nb>printf</span> <span class=s1>&#39;`%s`&#39;</span> <span class=s2>&#34;</span><span class=k>$(</span>cat ./gitdir<span class=k>)</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;|&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=nv>_headers</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;pwd&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>args</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;config#core.worktree&#34;</span>
</span></span><span class=line><span class=cl>    ./config#core.worktree
</span></span><span class=line><span class=cl>    ./gitdir
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> i in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>_headers</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span> <span class=nb>printf</span> <span class=s1>&#39;|`%s`&#39;</span> <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;|&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> i in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>_headers</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span> <span class=nb>printf</span> <span class=s2>&#34;|-&#34;</span><span class=p>;</span> <span class=k>done</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;|&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> p in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>paths_to_explore</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  explore_tab <span class=s2>&#34;</span><span class=nv>$p</span><span class=s2>&#34;</span> <span class=p>|</span> sed <span class=s2>&#34;s#</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>#\${PWD}#g&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><table><thead><tr><th><code>pwd</code></th><th><code>--git-common-dir</code></th><th><code>--git-dir</code></th><th><code>--is-inside-git-dir</code></th><th><code>--is-inside-work-tree</code></th><th><code>--show-toplevel</code></th><th><code>config#core.worktree</code></th><th><code>./config#core.worktree</code></th><th><code>./gitdir</code></th></tr></thead><tbody><tr><td><code>${PWD}</code></td><td><code>.git</code></td><td><code>.git</code></td><td><code>false</code></td><td><code>true</code></td><td><code>${PWD}</code></td><td><code>&lt;missing></code></td><td></td><td></td></tr><tr><td><code>${PWD}/nested</code></td><td><code>../.git</code></td><td><code>${PWD}/.git</code></td><td><code>false</code></td><td><code>true</code></td><td><code>${PWD}</code></td><td><code>&lt;missing></code></td><td></td><td></td></tr><tr><td><code>${PWD}/.git</code></td><td><code>.</code></td><td><code>.</code></td><td><code>true</code></td><td><code>false</code></td><td><code>fatal: this operation must be run in a work tree</code></td><td><code>&lt;missing></code></td><td><code>&lt;missing></code></td><td></td></tr><tr><td><code>${PWD}/.git/worktrees</code></td><td><code>${PWD}/.git</code></td><td><code>${PWD}/.git</code></td><td><code>true</code></td><td><code>false</code></td><td><code>fatal: this operation must be run in a work tree</code></td><td><code>&lt;missing></code></td><td></td><td></td></tr><tr><td><code>${PWD}/.git/worktrees/wrktr</code></td><td><code>${PWD}/.git</code></td><td><code>.</code></td><td><code>true</code></td><td><code>false</code></td><td><code>fatal: this operation must be run in a work tree</code></td><td><code>&lt;missing></code></td><td></td><td><code>${PWD}/wrktr/.git</code></td></tr><tr><td><code>${PWD}/.git/worktrees/wrktr/modules/submod</code></td><td><code>.</code></td><td><code>.</code></td><td><code>false</code></td><td><code>false</code></td><td><code>${PWD}/wrktr/submod</code></td><td><code>../../../../../wrktr/submod</code></td><td><code>../../../../../wrktr/submod</code></td><td></td></tr><tr><td><code>${PWD}/wrktr</code></td><td><code>${PWD}/.git</code></td><td><code>${PWD}/.git/worktrees/wrktr</code></td><td><code>false</code></td><td><code>true</code></td><td><code>${PWD}/wrktr</code></td><td><code>&lt;missing></code></td><td></td><td></td></tr><tr><td><code>${PWD}/wrktr/submod</code></td><td><code>${PWD}/.git/worktrees/wrktr/modules/submod</code></td><td><code>${PWD}/.git/worktrees/wrktr/modules/submod</code></td><td><code>false</code></td><td><code>true</code></td><td><code>${PWD}/wrktr/submod</code></td><td><code>../../../../../wrktr/submod</code></td><td></td><td></td></tr><tr><td><code>${PWD}/submod</code></td><td><code>${PWD}/.git/modules/submod</code></td><td><code>${PWD}/.git/modules/submod</code></td><td><code>false</code></td><td><code>true</code></td><td><code>${PWD}/submod</code></td><td><code>../../../submod</code></td><td></td><td></td></tr><tr><td><code>${PWD}/.git/modules/submod</code></td><td><code>.</code></td><td><code>.</code></td><td><code>false</code></td><td><code>false</code></td><td><code>${PWD}/submod</code></td><td><code>../../../submod</code></td><td><code>../../../submod</code></td><td></td></tr></tbody></table><table><thead><tr><th><code>pwd</code></th><th><code>--git-common-dir</code></th><th><code>--git-dir</code></th><th><code>--is-inside-git-dir</code></th><th><code>--is-inside-work-tree</code></th><th><code>--show-toplevel</code></th><th><code>config#core.worktree</code></th><th><code>./config#core.worktree</code></th><th><code>./gitdir</code></th></tr></thead><tbody><tr><td><code>${PWD}/.git</code></td><td><code>.</code></td><td><code>.</code></td><td><code>true</code></td><td><code>false</code></td><td><code>fatal: this operation must be run in a work tree</code></td><td><code>&lt;missing></code></td><td><code>&lt;missing></code></td><td></td></tr><tr><td><code>${PWD}/.git/worktrees</code></td><td><code>${PWD}/.git</code></td><td><code>${PWD}/.git</code></td><td><code>true</code></td><td><code>false</code></td><td><code>fatal: this operation must be run in a work tree</code></td><td><code>&lt;missing></code></td><td></td><td></td></tr><tr><td><code>${PWD}/.git/worktrees/wrktr</code></td><td><code>${PWD}/.git</code></td><td><code>.</code></td><td><code>true</code></td><td><code>false</code></td><td><code>fatal: this operation must be run in a work tree</code></td><td><code>&lt;missing></code></td><td></td><td><code>${PWD}/wrktr/.git</code></td></tr><tr><td><code>${PWD}/.git/worktrees/wrktr/modules/submod</code></td><td><code>.</code></td><td><code>.</code></td><td><code>false</code></td><td><code>false</code></td><td><code>${PWD}/wrktr/submod</code></td><td><code>../../../../../wrktr/submod</code></td><td><code>../../../../../wrktr/submod</code></td><td></td></tr><tr><td><code>${PWD}/.git/modules/submod</code></td><td><code>.</code></td><td><code>.</code></td><td><code>false</code></td><td><code>false</code></td><td><code>${PWD}/submod</code></td><td><code>../../../submod</code></td><td><code>../../../submod</code></td><td></td></tr></tbody></table></article></main><footer><span>© 2022-2022 CC BY-NC-SA 4.0</span></footer></body></html>